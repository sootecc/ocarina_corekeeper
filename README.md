
# Core Keeper 오카리나 자동 연주 스크립트

## 폴더
`/mnt/data/core_keeper_ocarina`

## 파일
- `ocarina_player.py` — 실행 스크립트
- `mapping.json` — 노트(C4~C5) → 키보드 키(예: 숫자 1~8) 매핑
- `song.txt` — 예시 악보 (간단한 토큰 형식)

## 설치
1) Python 3.10+ 설치
2) 커맨드라인에서:
```
pip install pyautogui
```
- macOS의 경우 "손쉬운 사용(입력 제어)" 권한을 터미널/IDE에 허용해야 합니다.
- Windows에서는 관리자 권한이 필요할 수 있습니다.

## 사용법
1) `mapping.json`을 실제 게임 내 오카리나 키에 맞게 수정하세요. (예: 숫자키 1~8, 혹은 QWERTY 등)
2) `song.txt` 첫 줄의 BPM을 조정하고, 아래와 같은 형식으로 음표를 적습니다.
   - 토큰: `NOTE:DEN` (예: `C4:4` = 4분음표, `E4:8` = 8분음표)
   - 쉼표: `R:DEN`
   - 마디 구분은 `|` 기호(선택사항)
3) 게임을 실행하고 오카리나를 장착/연주 가능한 상태로 둡니다.
4) 터미널에서:
```
python ocarina_player.py --song song.txt --map mapping.json --countdown 4
```
5) 카운트다운 동안 게임 창으로 전환하면 자동으로 연주됩니다. (중지: 콘솔에서 Ctrl+C)

## 주의
- 멀티플레이/공용 서버에서는 매크로로 간주될 수 있습니다. 서버 규칙과 게임 약관을 준수하세요.
- 이 스크립트는 교육/개인 사용을 위한 예제입니다.

## 확장 매핑 사용법 (이미지 레이아웃 대응)
`mapping_extended.json`은 아래 키들을 저음→고음 순의 **예시**로 매핑했습니다:

Z X C V B N M | S D G H J | Q W E R T Y U | 2 3 5 6 7  (총 24키)

노트 범위: C4 ~ B5 (반음 포함, C#, D#, F#, G#, A#).  
원하는 키 순서/음역으로 자유롭게 바꾸세요.

### 샤프/플랫 표기
- 샤프: `C#4`
- 플랫: `Db4`처럼 적어도 자동으로 `C#4`로 인식합니다.

### 트랜스포즈
악보 음역이 매핑과 안 맞으면 반음 단위로 이동:
```
python ocarina_player.py --transpose 2
```


---
## 새 악보 형식 (2옥타브 + 박자 헬퍼)
헤더:
- `BPM=120` (또는 `TEMPO=120`): 템포
- `UNIT=8`: 기본 음표 길이(8분음표). 표기 생략 시 이 단위를 사용

바디(토큰):
- `LOW:` / `HIGH:` 로 현재 옥타브 레인을 전환 (LOW=C4~B4, HIGH=C5~B5)
- 음표: `C`, `F#`, `Db`, `R`(쉼). 옥타브 숫자를 붙이면 강제: `C5`
- 길이: `:4`, `:8+16` (합산), 점음표는 `.`(하나당 ×1.5) 예: `C:4.`, `G:16..`
- 마디 구분은 `|` (선택)
- 어디서든 `TEMPO=xxx`, `UNIT=xx`로 변경 가능

예시:
```
BPM=118
UNIT=8
LOW:  C D E F# | G A B C.
HIGH: C D E F# | G:4 R:8 G:16. A:16 B:8
TEMPO=140
LOW:  E D C R:8 C:8
```

---
## 화음/홀드/스트럼/반복 표기
- 화음: `C+E+G:4` (노트 사이 `+`)
- 길이: `:4`, `:8+16`, 점음표 `.`
- 속성(괄호): `(h0.15,st0.01,rep3)`
  - `h` = hold(초), `st` = chord stagger/strum, `rep` = 반복 횟수
- 헤더 기본값: `HOLD=0.12`, `STAGGER=0.008`, `REP=1` (본문 어디서나 변경 가능)

예시:
```
BPM=96
UNIT=8
HOLD=0.12
STAGGER=0.010
LOW: C+E+G:4
LOW: G+B+D:8(rep3)
```
